' Gambas class file

' GambasCAD
' A simple CAD made in Gambas
'
' Copyright (C) Ing Martin P Cristia
'
' This program is free software; you can redistribute it and/or modify
' it under the terms of the GNU General Public License as published by
' the Free Software Foundation; either version 3 of the License, or
' (at your option) any later version.
'
' This program is distributed in the hope that it will be useful,
' but WITHOUT ANY WARRANTY; without even the implied warranty of
' MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
' GNU General Public License for more details.
'
' You should have received a copy of the GNU General Public License
' along with this program; if not, write to the Free Software
' Foundation, Inc., 51 Franklin St, Fifth Floor,
' Boston, MA  02110-1301  USA

' Tool maintained by Terco
Inherits ToolsBase
Create Static
Public Const Gender As String = "ZOOME"
Public limits As New Float[]

'  PanX y PanY estanen coordenadas de pantalla, o sea pixeles
'  por lo tanto algo que este en la posicion Px se dibujara en el pixel xPix = Px + PanX
'  si Px esta en coordenadas mundo, hay que reducirlo a pixels primero
'  PixPx = Pixels(Px) , entonces queda asi xPix = Pixels(Px) + PanX
'  Si quiero que eso quede en el centro de la pantalla xPix sera ViewportX/2, entonces

'  ViewportX/2 = Pixels(Px) + PanX , despejando PanX = ViewportX/2 - Pixels(Px)

Public Function Start(Optional ElemToBuild As Variant, _Mode As Integer = 0) As Boolean

    If _mode <> 1 Then

        limits = clsEntities.ComputeLimits()

        gcd.Drawing.xmenor = limits[0]
        gcd.Drawing.Ymenor = limits[1]
        gcd.Drawing.xmayor = limits[2]
        gcd.Drawing.ymayor = limits[3]
    End If
    If gcd.Drawing.Sheet.Entities.Count = 0 Then Return

    Dim SZx As Float
    ' ahora calculo donde estaria el centro de este dibujo

    Dim cx, cy As Float
    Dim px, py, h, w As Integer           ' coordenadas del punto medio

    cx = (gcd.Drawing.xmayor - gcd.Drawing.xmenor) ' tama√±o del mundo
    cy = (gcd.Drawing.Ymayor - gcd.Drawing.Ymenor)

    If cx = 0 Then cx = 0.00001
    If cy = 0 Then cy = 0.00001
    If gcd.Drawing.Sheet.Is3D Then
        h = gcd.Drawing.Sheet.scene.H
        w = gcd.Drawing.Sheet.scene.w
    Else

        h = gcd.Drawing.Sheet.GlSheet.h
        w = gcd.Drawing.Sheet.GlSheet.w
    Endif

    gcd.Drawing.Sheet.ScaleZoom = h / cy * 0.9

    szx = w / cx * 0.9

    If szx < gcd.Drawing.Sheet.ScaleZoom Then gcd.Drawing.Sheet.ScaleZoom = szx

    px = (gcd.Drawing.xmayor + gcd.Drawing.xmenor) / 2
    py = (gcd.Drawing.Ymayor + gcd.Drawing.Ymenor) / 2

    gcd.Drawing.Sheet.PanX = -gcd.Pixels(px)
    gcd.Drawing.Sheet.PanY = -gcd.Pixels(py)

    If gcd.Drawing.Sheet.ScaleZoom > 1e6 Or gcd.Drawing.Sheet.ScaleZoom < 1e-6 Then
        gcd.Drawing.Sheet.ScaleZoom = 1
        gcd.Drawing.Sheet.PanX = 0
        gcd.Drawing.Sheet.PanY = 0
    End If

    gcd.flgNewPosition = True

    ' Salimos de la tool
    gcd.clsJob = cadSelection
    gcd.redraw

End
